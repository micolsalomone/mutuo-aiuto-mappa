<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Centri di Mutuo Aiuto</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <!-- changed: externalized styles -->
  <link rel="stylesheet" href="src/css/style.css"/>
</head>
<body>
  <header>
    <div class="brand">
      <a class="logo" href="#" aria-label="Banco ‚Äî Home">
        <!-- logo inline: sostituisci con assets/logo.svg se preferisci -->
        <svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#9b5cff"/>
              <stop offset="1" stop-color="#6a1b9a"/>
            </linearGradient>
          </defs>
          <rect width="24" height="24" rx="6" fill="url(#g)"/>
          <path d="M7 16V8h5a3 3 0 0 1 0 6H7z" fill="#fff"/>
        </svg>
      </a>

      <div>
        <h3 style="margin:0;">Banco</h3>
      </div>
    </div>

    <!-- sposto la nav qui per poterla allineare a destra -->
    <nav class="nav-main" aria-label="Main navigation">
      <a class="nav-link active" href="#">Mappa</a>
      <a class="nav-link" href="#">Chi siamo</a>
      <a class="nav-link" href="CONTRIBUTING.md">Contribuisci</a>
    </nav>

    <div class="header-actions">
      <a class="btn btn--primary" href="#" id="addBtn" title="Proponi un centro">‚ûï Proponi un centro</a>
      <button id="bulkBtn" class="btn" title="Importa pi√π centri">üì• Importa</button>
      <button id="helpBtn" class="btn" title="Aiuto">‚ùî</button>
    </div>
  </header>

  <!-- Helper panel (toggleable) -->
  <div id="helperPanel" class="helper-panel" aria-hidden="true" role="region" aria-label="Aiuto rapido">
    <div class="helper-inner">
      <div class="helper-header">
        <strong>Aiuto rapido</strong>
        <button id="helperClose" class="btn" aria-label="Chiudi">‚úï</button>
      </div>
      <div class="helper-body">
        <p><strong>Segnala un centro:</strong> clicca sulla mappa per selezionare la posizione (o usa il centro mappa), trascina il marker per affinare le coordinate, poi premi "Proponi un centro" per aprire il form.</p>
        <p><strong>Import multiplo:</strong> usa "Importa" e incolla righe nel formato consigliato:<br>
        <code>Nome; Indirizzo; Telefono; Categoria; Lat; Lng; Descrizione (opzionale)</code></p>
        <p><strong>Copia coordinate:</strong> puoi copiare lat,lng dalle popup o dal form con il pulsante "Copia".</p>
        <p class="muted">I dati inviati verranno revisionati manualmente prima dell'inserimento sulla mappa.</p>
      </div>
    </div>
  </div>

  <!-- Bulk import modal: incolla lista/CSV/TSV -->
  <div id="bulkModal" class="modal" role="dialog" aria-hidden="true" aria-labelledby="bulkTitle">
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h4 id="bulkTitle">Import multiplo ‚Äî incolla qui la lista</h4>
        <button id="bulkClose" class="btn" aria-label="Chiudi">‚úï</button>
      </header>

      <div style="display:flex;flex-direction:column;gap:10px">
        <p class="muted">Formato consigliato per riga (separatore ;):<br>
          Nome; Indirizzo; Telefono; Categoria; Lat; Lng; Descrizione (opzionale)</p>

        <textarea id="bulkInput" rows="8" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.08)"></textarea>

        <div style="display:flex;gap:8px;align-items:center;">
          <button id="bulkParse" class="btn">Anteprima</button>
          <button id="bulkClear" class="btn">Pulisci</button>
          <div id="bulkCount" style="margin-left:auto;color:#556770;font-size:0.95rem"></div>
        </div>

        <div id="bulkPreview" style="max-height:240px;overflow:auto;border-radius:8px;padding:8px;border:1px dashed rgba(2,6,23,0.06);background:#fff"></div>

        <div style="display:flex;justify-content:flex-end;gap:8px">
          <button id="bulkSubmit" class="btn btn--primary">Crea issue con tutte le segnalazioni</button>
          <button id="bulkCancel" class="btn">Annulla</button>
        </div>
      </div>
    </div>
  </div>

  <div id="map"></div>

  <div id="coords" style="display:none;"></div>

  <!-- toast per notifiche copia -->
  <div id="toast" aria-live="polite"></div>

  <!-- Report modal: form per creare issue -->
  <div id="reportModal" class="modal" role="dialog" aria-hidden="true" aria-labelledby="reportTitle">
    <div class="modal-backdrop" data-action="close"></div>
    <div class="modal-panel" role="document">
      <header class="modal-header">
        <h4 id="reportTitle">Segnala nuovo centro</h4>
        <button id="reportClose" class="btn" aria-label="Chiudi">‚úï</button>
      </header>

      <form id="reportForm" class="report-form">
        <label>
          Nome del centro *
          <input name="name" type="text" required />
        </label>

        <label>
          Indirizzo completo *
          <input name="address" type="text" required />
        </label>

        <label>
          Telefono
          <input name="phone" type="text" inputmode="tel" />
        </label>

        <label>
          Categoria *
          <select name="category" required>
            <option value="">Seleziona...</option>
            <option>Casa delle donne / CAV</option>
            <option>Centro sociale / Casa del popolo</option>
            <option>Sportello immigrazione</option>
            <option>Servizi sociali</option>
            <option>Casa famiglia</option>
            <option>Altro</option>
          </select>
        </label>

        <label>
          Descrizione / attivit√†
          <textarea name="description" rows="3"></textarea>
        </label>

        <div class="coords-row">
          <label>
            Latitudine
            <input name="lat" type="text" pattern="-?[0-9.]{3,}" required />
          </label>
          <label>
            Longitudine
            <input name="lng" type="text" pattern="-?[0-9.]{3,}" required />
          </label>
          <button type="button" id="copyCoordsInForm" class="btn">Copia</button>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn--primary">Apri issue</button>
          <button type="button" id="reportCancel" class="btn">Annulla</button>
        </div>

        <p class="muted">Le informazioni verranno revisionate prima dell'inserimento sulla mappa.</p>
      </form>
    </div>
  </div>

  <!-- Hotlines overlay -->
  <div id="hotlineWrapper" aria-hidden="false">
    <button id="hotlineBtn" class="hotline-btn" aria-expanded="false" aria-controls="hotlinePanel" title="Numeri utili">üìû</button>

    <aside id="hotlinePanel" class="hotline-panel" role="dialog" aria-hidden="true" aria-label="Numeri utili">
      <header class="hotline-header">
        <strong>Numeri utili</strong>
        <button id="hotlineClose" class="hotline-close" aria-label="Chiudi">‚úï</button>
      </header>

      <div class="hotline-list" role="list"></div>

      <footer class="hotline-footer">
        <button id="hotlineCopyAll" class="btn" type="button">Copia tutti i numeri</button>
      </footer>
    </aside>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- changed: externalized script -->
  <script src="src/js/app.js"></script>
</body>
</html>
